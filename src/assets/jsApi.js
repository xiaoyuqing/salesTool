/*! FS JSAPI v2.0.0 | (c) fxiaoke.com */
(function(){"use strict";var a="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this,b=(a.navigator||{}).userAgent||"",c=function(){},d=function(a){console.error(a)},e=(a.document||{}).addEventListener,f=/FSBrowser\/((\d+.?)+)/.test(b)?RegExp.$1:"",g=function(a){return parseFloat(f)>a},h={},i=!1,j=c,k=c,l=function(b){setTimeout(function(){if(b&&3e4===b.errorCode)if(k!==c)k(b);else{var d=a.WebViewJavascriptBridge,e=g(5.3);d&&d.send({action:"notification.toast",icon:"success",text:"纷享版本太旧，部分功能可能运行异常，请更新到最新版本。",duration:e?3e3:3,delay:e?1e3:1})}else k(b)},0)},m=function(a,b,c){c=c||{},b=b||{},delete b.action;var d={M1:"JSAPI_Invoked",M2:"FSOpen."+a,M3:[JSON.stringify(b),location.href].join(","),M4:"errCode:"+(c.errorCode||0),M5:h.appId,M6:"jsapi:v"+n.version+",app:v"+n.appVersion};console.log(d),n.send({action:"util.traceEvent",event:d})},n={ios:/iPhone|iPad|iPod/i.test(b),android:/Android/i.test(b),version:"2.0.0",hasBridge:g(0)||void 0!==a._WebViewJavascriptBridge,log:function(a){return"function"==typeof a&&(j=a),this},config:function(b){return b&&(h={url:b.url,appId:b.appId,timestamp:b.timestamp,nonceStr:b.nonceStr,signature:b.signature,jsApiList:b.jsApiList,internalId:b.internalId}),null==h.url&&a.location&&(h.url=a.location.href),this},error:function(a){return"function"==typeof a&&(k=a),this},ready:function(b){if(!n.hasBridge)return l({errorCode:3e4,errorMessage:"Unsupported"}),this;var c=function(a){if(!a)return void l({errorCode:30002,errorMessage:"WebViewJavascriptBridge initialized fail"});if(!i){i=!0;try{a.init(function(a,b){})}catch(c){console.log(c),j("WebViewJavascriptBridge maybe initialized fail")}if(!g(5.3))return void l({errorCode:3e4,errorMessage:"WebViewJavascriptBridge needs update"});try{h.appId?(h.action="config",a.send(h,function(c){return j("Config success for appid "+h.appId),0!==c.errorCode?void k({errorCode:c.errorCode,errorMessage:c.errorMessage}):void b(a)})):b(a)}catch(c){console.log(c),j("WebViewJavascriptBridge config or callback fail")}a.send({action:"runtime.getVersion"},function(a){n.appVersion=a.ver})}};return a.WebViewJavascriptBridge?c(WebViewJavascriptBridge):e&&e.call(a.document,"WebViewJavascriptBridgeReady",function(){c(a.WebViewJavascriptBridge)},!1),this}};["send","callHandler","registerHandler"].forEach(function(b){n[b]=function(){var c=a.WebViewJavascriptBridge,d=[].slice.call(arguments),e=d.pop();return c?(j("Call interface "+b,d),void c[b].apply(c,arguments)):void("function"==typeof e&&e({errorCode:30001,errorMessage:"WebViewJavascriptBridge is undefined"}))}});var o={cache:{},on:function(a,b){var c=o.cache;c[a]?c[a].indexOf(b)<0&&c[a].push(b):(c[a]=[b],n.registerHandler(a,function(b){j("Native callback",b),c[a]&&c[a].length&&c[a].forEach(function(a){try{a(b)}catch(c){d(c)}})})),j(["Bind listener for ",a,", current handlers: ",c[a].length].join(""))},off:function(a,b){var c=o.cache;return b?((c[a]||[]).forEach(function(d,e,f){d==b&&(f.splice(e,1),f.length<=0&&(delete c[a],n.registerHandler(a,null)))}),void j(["Unbind listener for ",a,", current handlers: ",(c[a]||[]).length].join(""))):(delete c[a],n.registerHandler(a,null),void j("Unbind listener for "+a))},one:function(a,b){o.off(a),o.on(a,b)}};n.event=o;var p={},q=function(a,b){return p.toString.call(a).toLowerCase()=="[object "+b.toLowerCase()+"]"},r=function(a){return q(a,"function")},s=function(){return Math.floor(1e8*Math.random())},t={audioPlayHandler:{handler:function(a){n.event.one("audioPlayHandler",function(b){if(r(a.onStop))try{a.onStop(b)}catch(c){d(c)}})}},audioRecordHandler:{handler:function(a){n.event.one("audioRecordHandler",function(b){if(r(a.onStop))try{a.onStop(b)}catch(c){d(c)}})}},openWindowHandler:{cache:{},handler:function(a){n.event.one("openWindowHandler",function b(c){if(r(a.onClose))try{a.onClose(c)}catch(e){d(e)}n.event.off("openWindowHandler",b)})}},backKeyPressedHandler:{handler:function(a){n.event.one("backKeyPressedHandler",function(b){if(r(a.onBack))try{a.onBack(b)}catch(c){d(c)}})}},webviewCloseHandler:{handler:function(a){n.event.one("webviewCloseHandler",function(b){if(r(a.onClose))try{a.onClose(b)}catch(c){d(c)}})}},pullRefreshHandler:{cache:{},handler:function(a){n.event.one("pullRefreshHandler",function(b){if(r(a.onPullRefresh))try{a.onPullRefresh(b)}catch(c){d(c)}})}},fsMenuClickHandler:{cache:null,btnreg:/^(service|share)\:(favorite|to|via)/,handler:function(a,b){if(!this.cache){this.cache={};var c=this;n.event.one("fsMenuClickHandler",function(a){if(a&&c.btnreg.test(a.btnId)){var b;b="service"==RegExp.$1?"favorite.add":""+a.btnId.replace(":",".");var d=c.cache[b];z("service."+b,d)}})}return this.cache[b]=a,!1}},middleBtnClickHandler:{handler:function(a){n.event.one("middleBtnClickHandler",function(b){if(r(a.onClick))try{a.onClick(b)}catch(c){d(c)}})}},leftBtnClickHandler:{handler:function(a){n.event.one("leftBtnClickHandler",function(b){if(r(a.onClick))try{a.onClick(b)}catch(c){d(c)}else n.webview.back()})}},rightBtnClickHandler:{cache:{},handler:function(a){if(r(a.onClick)){var b="fs-btn-"+s(),c=t.rightBtnClickHandler.cache;return a.items&&a.items.length?(c[b]={idList:[],handler:a.onClick},a.items.forEach(function(a){c[b].idList.push(a.btnId)})):(a.btnId=b,c[b]=a.onClick),n.event.on("rightBtnClickHandler",function(a){if(a&&a.btnId){var d=c[a.btnId];if(r(d))return delete a.btnId,void d(a);var e=c[b];e&&e.idList.indexOf(a.btnId)>=0&&(d=e.handler)(a)}}),b}}},uploadFileHandler:{cache:{},handler:function(a){if(r(a.onUpload)){var b="fs-upl-"+s(),e=t.uploadFileHandler.cache;e[b]={files:{},loaded:0,counter:0,handler:a.onUpload},a.uploadId=b;var f=a.onSuccess||c;return a.onSuccess=function(a){if(a&&!a.errorCode){var c=a.selectedFiles||a.selectedImages||[];c.forEach(function(a){var c=e[b];c&&(c.files[a.id]=!1,c.counter++)})}f(a)},n.event.on("uploadFileHandler",function g(a){if(a&&a.id){var c=e[b];if(!c)return;c.files.hasOwnProperty(a.id)&&(c.files[a.id]=!0,c.loaded++);var f=c.handler;try{f(a,{count:c.counter,loaded:c.loaded})}catch(h){d(h)}c.loaded>=c.counter&&(delete e[b],n.event.off("uploadFileHandler",g))}}),b}}},downloadFileHandler:{handler:function(a){n.event.one("downloadFileHandler",function(b){if(r(a.onProgress))try{a.onProgress(b)}catch(c){d(c)}})}}};n._nativeCallbackCache=t;var u=!0,v=({support:n.appVersion<=5.3},t.uploadFileHandler),w=t.fsMenuClickHandler,x={"runtime.getVersion":u,"runtime.getCurrentUser":u,"runtime.requestAuthCode":u,"runtime.showUpdate":u,"device.authenticateUser":u,"device.getAP":u,"device.getNetworkType":u,"device.getUUID":u,"device.scan":u,"device.vibrate":u,"launcher.checkAppInstalled":u,"launcher.launchApp":u,"webview.back":u,"webview.close":u,"webview.open":{before:t.openWindowHandler.handler},"webview.onBackWebview":{before:t.backKeyPressedHandler.handler,support:n.android},"webview.onCloseWebview":{before:t.webviewCloseHandler.handler},"webview.setOrientation":u,"webview.navbar.removeRightBtns":{before:function(a){n.event.off("rightBtnClickHandler")}},"webview.navbar.hideMenu":u,"webview.navbar.setLeftBtn":{before:t.leftBtnClickHandler.handler},"webview.navbar.setRightBtns":{before:function(a){n.event.off("rightBtnClickHandler"),t.rightBtnClickHandler.handler(a)}},"webview.navbar.setMiddleBtn":{before:t.middleBtnClickHandler.handler},"webview.navbar.setTitle":{before:function(b){a.document&&(a.document.title=b.title||"")}},"webview.navbar.showMenu":u,"webview.menu.onShareToConversation":{before:function(a,b){return n.send({action:b}),w.handler(a,"share.toConversation")}},"webview.menu.onShareToCRMContact":{before:function(a,b){return n.send({action:b}),w.handler(a,"share.toCRMContact")}},"webview.menu.onShareToFeed":{before:function(a,b){return n.send({action:b}),w.handler(a,"share.toFeed")}},"webview.menu.onShareViaMail":{before:function(a,b){return n.send({action:b}),w.handler(a,"share.viaMail")}},"webview.menu.onShareToQQFriend":{before:function(a,b){return n.send({action:b}),w.handler(a,"share.toQQFriend")}},"webview.menu.onShareViaSMS":{before:function(a,b){return n.send({action:b}),w.handler(a,"share.viaSMS")}},"webview.menu.onShareToWXFriend":{before:function(a,b){return n.send({action:b}),w.handler(a,"share.toWXFriend")}},"webview.menu.onShareToWXMoments":{before:function(a,b){return n.send({action:b}),w.handler(a,"share.toWXMoments")}},"webview.page.copyURL":u,"webview.page.generateQR":u,"webview.page.openWithBrowser":u,"webview.page.refresh":u,"webview.bounce.disable":u,"webview.bounce.enable":u,"webview.pullRefresh.disable":{before:function(a){n.event.off("pullRefreshHandler")}},"webview.pullRefresh.enable":{before:t.pullRefreshHandler.handler},"webview.pullRefresh.stop":u,"widget.showActionSheet":u,"widget.showAlert":u,"widget.showConfirm":u,"widget.hidePreloader":u,"widget.showModal":u,"widget.showPrompt":u,"widget.showPreloader":u,"widget.showToast":u,"widget.showDateTimePicker":u,"widget.showEditor":u,"service.contact.setMark":u,"service.contact.getServiceChannelsInfo":u,"service.contact.getUsersInfo":u,"service.contact.select":u,"service.contact.selectDepartment":u,"service.contact.selectUser":u,"service.contact.openDepartment":u,"service.contact.openUserProfile":u,"service.contact.openServiceProfile":u,"service.contact.getMembers":u,"service.conversation.open":u,"service.conversation.setupFSCall":u,"service.conversation.setupFSConference":u,"service.favorite.add":u,"service.favorite.manage":u,"service.geo.getLocation":u,"service.geo.selectPOI":u,"service.geo.openMap":u,"service.mail.shareToConversation":u,"service.mail.shareToFeed":u,"service.pay.request":u,"service.pay.requestForCorp":u,"service.pay.openWallet":u,"service.share.toConversation":u,"service.share.toCRMContact":u,"service.share.toFeed":u,"service.share.viaMail":u,"service.share.toQQFriend":u,"service.share.viaSMS":u,"service.share.toWXFriend":u,"service.share.toWXMoments":u,"service.calendar.open":u,"service.calendar.createEvent":u,"service.feed.open":u,"service.feed.create":u,"service.feed.createShare":u,"service.feed.createDiary":u,"service.feed.createApproval":u,"service.feed.createTask":u,"service.feed.createSchedule":u,"service.feed.createOrder":u,"service.disk.open":u,"service.disk.addFile":u,"service.disk.selectFile":u,"media.file.preview":u,"media.file.upload":{before:v.handler,support:n.android},"media.file.download":{support:n.android,before:t.downloadFileHandler.handler},"media.file.manage":{support:n.android},"media.image.preview":u,"media.image.upload":{before:v.handler},"media.audio.startRecord":{before:t.audioRecordHandler.handler},"media.audio.stopRecord":u,"media.audio.play":{before:t.audioPlayHandler.handler},"media.audio.pause":u,"media.audio.resume":u,"media.audio.stop":u,"util.traceEvent":u,"util.open":u},y=function(a,b){for(var c=a.split("."),d=n,e=0,f=c.length;f>e;++e)e===f-1&&(d[c[e]]=b),"undefined"==typeof d[c[e]]&&(d[c[e]]={}),d=d[c[e]]},z=function(a,b){b=b||{};var d,e=!0,f=x[a];if(g(5.3)){if(!n.hasBridge)return d={errorCode:3e4,errorMessage:"Unsupported"},b.onFail&&b.onFail(d),void m(a,b,d);if(f.support===!1)return d={errorCode:40004,errorMessage:"Unsupported"},b.onFail&&b.onFail(d),void m(a,b,d);if(f.parser){var h=f.parser(b);if(h)return d={errorCode:4e4,errorMessage:h},b.onFail&&b.onFail(d),void m(a,b,d)}if(f.before&&(e=f.before(b,a),e===!1))return e;var i=b.onFail||c,k=b.onSuccess||c,l=function(c,d){j("Native response",c),c=c||{},m(a,b,c);var e=null==c.errorCode?0:c.errorCode;if(0!==e){if(5e4===e)return;return void i({errorCode:e,errorMessage:c.errorMessage||""})}k(c,b)};return delete b.onFail,delete b.onSuccess,f===u?(b.action=a,n.send(b,l),e):"string"==typeof f?(b.action=f,n.send(b,l),e):f["native"]?(n.callHandler(f.action,b,l),e):(b.action=b.__alias||f.action||a,n.send(b,l),e)}},A=function(a){return function(b){return z(a,b)}};for(var B in x)y(B,A(B));"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=n:"function"==typeof define&&(define.amd||define.cmd)?define("FSOpen",[],function(b,c,d){return a.FSOpen=n,n}):a.FSOpen=n}).call(this);